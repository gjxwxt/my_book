### 第02章 MySQL的数据目录

| MySQL的目录结构                             | 说明                                 |
| ------------------------------------------- | ------------------------------------ |
| bin目录                                     | 所有MySQL的可执行文件。如：mysql.exe |
| MySQLInstanceConfig.exe                     | 数据库的配置向导，在安装时出现的内容 |
| data目录                                    | 系统数据库所在的目录                 |
| my.ini文件                                  | MySQL的主要配置文件                  |
| c:\ProgramData\MySQL\MySQL Server 8.0\data\ | 用户创建的数据库所在的目录           |

#### **1. MySQL8的主要目录结构**

```shell
find / -name mysql
```

![image-20221126200049361](C:\Users\gaoji\AppData\Roaming\Typora\typora-user-images\image-20221126200049361.png)

##### **1.1** **数据库文件的存放路径** 

**MySQL数据库文件的存放路径：/var/ib/mysql/**

MySQL服务器程序在启动时会到文件系统的某个目录下加载一些文件，之后在运行过程中产生的数据也都余存储到这个目录下的某些文件中，这个目录就称为**数据目录**.

![image-20221126202727576](C:\Users\gaoji\AppData\Roaming\Typora\typora-user-images\image-20221126202727576.png)

MySQL把数据都存到哪个路径下呢？其实数据目录对应着一个系统变量datadir,我们在使用客户端与服务器建立连接之后查看这个系统变量的值就可以了：

```mysql
show variables like 'datadir'; 
# /var/lib/mysql/ 类似于win下的c盘的目录
```

##### **1.2** **相关命令目录**

**相关命令目录：/usr/bin 和/usr/sbin。**

安装目录下非常重要的b1n目录，它里边存储了许多关于控制客户端程序和服务器程序的命令（许多可执行文件，比如mysq1,mysqld,mysqld_.safe等)。而数据目录是用来存储MySQL在运行过程中产生的数据，注意区分开二者。

##### **1.3** **配置文件目录**

**配置文件目录：/usr/share/mysql-8.0（命令及配置文件），/etc/mysql（如my.cnf）**

#### **2.** **数据库和文件系统的关系**

像InnoDB、MyISAM这样的存储引擎都是把表存储在磁盘上的，操作系统用来管理磁盘的结构被称为文件系统，所以用专业一点的话来表述就是：像InnoDB、*MyISAM*这样的存储的引擎都是把表存储在文件系统上的。

当我们想读取数据的时候，这些存储引擎会从文件系统中把数据读出来返回给我们，当我们想写入数据的时候这些存储引擎会把这些数据又写回文件系统。

##### **2.1** **默认数据库** 

mysql自带4个系统数据库：

- mysql

mysql系统自带的核心数据库，存储了mysql的用户账户和权限信息，一些存储过程、事件的定义信息，一些运行过程中产生的日志信息，一些帮助信息以及时区信息等。

- information_schema

这个数据库保存着mysql服务器所有其他数据库的信息。比如有那些表、那些视图、那些触发器、那些列、那些索引。这些数据并不是真实的用户数据，而是描述性信息，有时候也称为元数据。在该库中提供了一些以innodb_sys开头的表，用于表示内部系统表。

- performation_schema

主要保存mysql服务器运行过程中的一些状态信息，可以用来监控mysql服务的各类指标。包括统计最近执行了那些语句，在执行过程的各个阶段都花费了多长时间，内存的使用情况等信息。

- sys

该数据库主要通过视图的形式把information_schema和 performation_schema结合起来，帮助开发人员监控mysql的技术性能。

##### 2.2 数据库在文件系统中的表示

使用create database语句创建一个数据库时，在文件系统上实际发生了什么呢？
每个数据库都对应数据目录下的一个子目录，每当新创建一个数据库时，mysql会做如下两点：
（1）在**数据目录下**创建一个和数据库名同名的子目录。
（2）在**该子目录下**创建一个db.opt的文件（5.7及之前版本），这个文件中包含了该数据库的各种数据，比如该数据库的字符集和比较规则。

![image-20221126202952775](C:\Users\gaoji\AppData\Roaming\Typora\typora-user-images\image-20221126202952775.png)

这个数据目录下除了information_schema数据库外，其他数据库在该目录下都有对应子目录。

###### **2.2.1 InnoDB存储引擎模式** 

**1.** **表结构**

为了保存表结构，`InnoDB`在`数据目录`下对应的数据库子目录下创建了一个专门用于`描述表结构的文件`

```
表名.frm
```

**2.** **表中数据和索引**

**① 系统表空间（system tablespace）**

默认情况下，InnoDB会在数据目录下创建一个名为`ibdata1`、大小为`12M`的`自拓展`文件，这个文件就是对应的`系统表空间`在文件系统上的表示。自拓展文件属于不够用的时候自己就会增加文件大小

需要注意的一点是，在一个MySQL服务器中，系统表空间只有一份。从MySQL5.5.7到MySQL5.6.6之间的各个版本中，我们表中的数据都会被默认存储到这个系统表空间。

**② 独立表空间(file-per-table tablespace)** 

在MySQL5.6.6以及之后的版本中，InnoDB并不会默认的把各个表的数据存储到系统表空间中，而是为`每一个表建立一个独立表空间`，也就是说我们创建了多少个表，就有多少个独立表空间。使用`独立表空间`来存储表数据的话，会在数据目录下该表所属数据库对应的子目录下创建一个表示该独立表空间的文件，文件名和表名相同。

```
表名.ibd
```

> MySQL8.0中不再单独提供`表名.frm`，而是合并在`表名.ibd`文件中。

**③ 系统表空间与独立表空间的设置**

我们可以自己指定使用`系统表空间`还是`独立表空间`来存储数据，这个功能由启动参数`innodb_file_per_table`控制，可以在my.cnf文件中设置

```ini
[server] 
innodb_file_per_table=0 # 0：代表使用系统表空间； 1：代表使用独立表空间
```

**④ 其他类型的表空间**

随着MySQL的发展，除了上述两种老牌表空间之外，现在还新提出了一些不同类型的表空间，比如通用表空间（general tablespace）、临时表空间（temporary tablespace）等。

![img](https://img-blog.csdnimg.cn/9e41024ac53d43c4bd717ceed2eaf131.png)

###### **2.2.2 MyISAM存储引擎模式** 

**1.** **表结构**

在存储表结构方面， MyISAM 和 InnoDB 一样，也是在`数据目录`下对应的数据库子目录下创建了一个专门用于描述表结构的文件

```
表名.frm
```

**2.** **表中数据和索引**

在MyISAM中的索引全部都是`二级索引`，该存储引擎的`数据和索引是分开存放`的。所以在文件系统中也是使用不同的文件来存储数据文件和索引文件，同时表数据都存放在对应的数据库子目录下。

```
test.frm 存储表结构 #MySQL8.0 改为了 b.xxx.sdi
test.MYD 存储数据 (MYData) 
test.MYI 存储索引 (MYIndex
```

#### 总结

![image-20221126204350826](C:\Users\gaoji\AppData\Roaming\Typora\typora-user-images\image-20221126204350826.png)

##### 2.3 视图在文件系统中的表示

视图其实是虚拟的表，所以在存储视图的时候不需要存储真实的数据，只需要把它的结构存储起来就行了。只会存储一个`视图名.frm`文件。

##### 2.4其他的文件

除了我们上边说的这些用户自己存储的数据以外，数据目录下还包括为了更好运行程序的一些额外文件，主要包括这几种类型的文件：

- 服务器进程文件

我们知道每运行一个MySQL服务器程序，都意味着启动一个进程。MySQL服务器会把自己的进程ID写入到一个
文件中。

+ 服务器日志文件

在服务器运行过程中，会产生各种各样的日志，比如常规的查询日志、错误日志、二进制日志、redo日志等。这些日志各有各的用途。

+ 默认/自动生成的SSL和RSA证书和密钥文件

主要是为了客户端和服务器安全通信而创建的一些文件。